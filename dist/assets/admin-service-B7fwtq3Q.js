import{b as p,c as o,a as c,q as l,w as h,g as m,d as i,e as g,s as f,u as w,f as R,r as T,h as k,i as I,j as x,k as E}from"./firebase-config-DyDltD9C.js";const A="users",z=async e=>{if(!e)return!1;try{const s=await m(i(c,A,e.uid));if(s.exists())return s.data().role==="admin";if(e.email){const r=l(o(c,A),h("email","==",e.email)),t=await p(r);if(!t.empty)return t.docs[0].data().role==="admin"}return!1}catch{return!1}},F=async e=>{try{const r=(await p(o(c,"courses"))).docs.reduce((a,u)=>{const n=u.data().rank;return typeof n=="number"&&n>a?n:a},0);return{success:!0,id:(await g(o(c,"courses"),{...e,rank:e.rank??r+1,createdAt:f(),updatedAt:f()})).id}}catch(s){return{success:!1,error:s.message}}},_=async(e,s)=>{try{const r=i(c,"courses",e);return await w(r,{rank:s,updatedAt:f()}),{success:!0}}catch(r){return{success:!1,error:r.message}}},j=async(e,s)=>{try{const r=i(c,"courses",e);return await w(r,{...s,updatedAt:f()}),{success:!0}}catch(r){return{success:!1,error:r.message}}},L=async e=>{try{return await R(i(c,"courses",e)),{success:!0}}catch(s){return{success:!1,error:s.message}}},O=async()=>{try{const e=await p(o(c,"courses")),s=[];return e.forEach(r=>{s.push({id:r.id,...r.data()})}),s.sort((r,t)=>(r.rank??9999)-(t.rank??9999)),{success:!0,courses:s}}catch(e){return{success:!1,error:e.message}}},P=async e=>{try{const s=await m(i(c,"courses",e));return s.exists()?{success:!0,course:{id:s.id,...s.data()}}:{success:!1,error:"Course not found"}}catch(s){return{success:!1,error:s.message}}},$=async()=>{try{const e=await p(o(c,"pdfs")),s=[];return e.forEach(r=>{s.push({id:r.id,...r.data()})}),{success:!0,pdfs:s}}catch(e){return{success:!1,error:e.message}}},B=(e,s,r)=>new Promise(t=>{const u=`${Date.now()}_${e.name}`,n=T(k,`pdfs/${u}`),q=x(n,e);q.on("state_changed",d=>{const y=Math.round(d.bytesTransferred/d.totalBytes*100);r==null||r(y)},d=>t({success:!1,error:d.message}),async()=>{try{const d=await E(q.snapshot.ref),y=await g(o(c,"pdfs"),{name:e.name,url:d,size:e.size,courseId:s,uploadedAt:f()}),C=i(c,"courses",s),D=await m(C);if(D.exists()){const S=D.data().pdfIds??[];S.includes(y.id)||await w(C,{pdfIds:[...S,y.id],updatedAt:f()})}t({success:!0,id:y.id,url:d})}catch(d){t({success:!1,error:d.message})}})}),N=async(e,s,r)=>{try{try{const u=T(k,s);await I(u)}catch{}await R(i(c,"pdfs",e));const t=i(c,"courses",r),a=await m(t);if(a.exists()){const u=a.data().pdfIds??[];await w(t,{pdfIds:u.filter(n=>n!==e),updatedAt:f()})}return{success:!0}}catch(t){return{success:!1,error:t.message}}},M=async e=>{try{const s=l(o(c,"practiceTests"),h("courseId","==",e)),r=await p(s),t=[];return r.forEach(a=>{t.push({id:a.id,...a.data()})}),{success:!0,tests:t}}catch(s){return{success:!1,error:s.message}}},Q=async e=>{try{return{success:!0,id:(await g(o(c,"practiceTests"),{...e,createdAt:f()})).id}}catch(s){return{success:!1,error:s.message}}},W=async()=>{try{const e=await p(o(c,"practiceTests")),s=[];return e.forEach(r=>{s.push({id:r.id,...r.data()})}),{success:!0,tests:s}}catch(e){return{success:!1,error:e.message}}},G=async e=>{try{return await R(i(c,"practiceTests",e)),{success:!0}}catch(s){return{success:!1,error:s.message}}},H=async e=>{try{return{success:!0,id:(await g(o(c,"purchases"),{...e,purchasedAt:f()})).id}}catch(s){return{success:!1,error:s.message}}},b=async e=>{try{const s=l(o(c,"purchases"),h("userId","==",e)),r=await p(s),t=[];return r.forEach(a=>{t.push({id:a.id,...a.data()})}),{success:!0,purchases:t}}catch(s){return{success:!1,error:s.message}}},J=async()=>{try{const e=await p(o(c,"purchases")),s=[];return e.forEach(r=>{s.push({id:r.id,...r.data()})}),{success:!0,purchases:s}}catch(e){return{success:!1,error:e.message}}},K=async(e,s)=>{try{const r=l(o(c,"purchases"),h("userId","==",e),h("courseId","==",s),h("status","==","completed"));return{success:!0,hasPurchased:!(await p(r)).empty}}catch(r){return{success:!1,error:r.message}}},V=async e=>{var s;try{const r=await b(e);if(!r.success)return r;const t=((s=r.purchases)==null?void 0:s.filter(u=>u.status==="completed").map(u=>u.courseId))||[],a=[];for(const u of t){const n=await P(u);n.success&&n.course&&a.push(n.course)}return{success:!0,courses:a}}catch(r){return{success:!1,error:r.message}}};export{O as a,$ as b,W as c,H as d,P as e,M as f,V as g,K as h,z as i,J as j,F as k,L as l,_ as m,N as n,G as o,Q as p,B as q,j as u};
