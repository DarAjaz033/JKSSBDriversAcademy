import"./firebase-config-D0UifA0H.js";/* empty css               */import{o as m}from"./auth-service-By807CDz.js";import{i as h,u as p,l as g,g as y,m as b,n as c}from"./admin-service-BQGa3a-U.js";import{s as a,a as v}from"./admin-toast-8NJD7knF.js";class f{constructor(){this.editingCourseId=null,this.coursesList=[],this.form=document.getElementById("course-form"),this.submitBtn=document.getElementById("submit-btn"),this.cancelBtn=document.getElementById("cancel-btn"),this.coursesContainer=document.getElementById("courses-container"),this.descriptionPointsContainer=document.getElementById("description-points-container"),this.addPointBtn=document.getElementById("add-point-btn"),this.init()}async init(){m(async t=>{if(!t){window.location.href="./admin-login.html";return}if(!await h(t)){window.location.href="./admin-login.html";return}this.form.addEventListener("submit",i=>this.handleSubmit(i)),this.cancelBtn.addEventListener("click",()=>this.cancelEdit()),this.addPointBtn.addEventListener("click",()=>this.addDescriptionPoint()),this.ensureDescriptionPoints(),await this.loadCourses()},!0)}buildDescriptionFromForm(){const t=document.getElementById("description-heading").value.trim(),e=this.descriptionPointsContainer.querySelectorAll(".description-point-input"),i=Array.from(e).map(n=>n.value.trim()).filter(Boolean);if(i.length===0&&!t)return"";const s=i.map((n,o)=>`${o+1}. ${n}`);return t?[t,...s].join(" "):s.join(" ")}ensureDescriptionPoints(){this.descriptionPointsContainer.children.length===0&&this.addDescriptionPoint("",!1)}addDescriptionPoint(t="",e=!0){const i=this.descriptionPointsContainer.children.length+1,s=document.createElement("div");s.className="description-point-row";const n=document.createElement("span");n.className="point-number",n.textContent=`${i}.`;const o=document.createElement("input");o.type="text",o.className="form-input description-point-input",o.placeholder="e.g., Identification of major assemblies",o.value=t;const d=document.createElement("button");d.type="button",d.className="btn-icon delete",d.title="Remove point",d.style.flexShrink="0",d.innerHTML='<i data-lucide="trash-2" width="16" height="16"></i>',d.addEventListener("click",()=>{s.remove(),this.updatePointNumbers()}),s.append(n,o,d),this.descriptionPointsContainer.appendChild(s),window.lucide?.createIcons(),e&&o.focus()}updatePointNumbers(){this.descriptionPointsContainer.querySelectorAll(".description-point-row").forEach((t,e)=>{const i=t.querySelector(".point-number");i&&(i.textContent=`${e+1}.`)})}parseDescriptionToForm(t){const e=t.trim(),i=e.split(/\s*\d+\.\s+/).map(s=>s.trim()).filter(Boolean);document.getElementById("description-heading").value="",this.descriptionPointsContainer.innerHTML="",i.length>1?(document.getElementById("description-heading").value=i[0],i.slice(1).forEach(s=>this.addDescriptionPoint(s,!1))):e?this.addDescriptionPoint(e,!1):this.ensureDescriptionPoints()}async handleSubmit(t){t.preventDefault();const e=this.buildDescriptionFromForm(),i=document.getElementById("syllabus").value.trim(),s=document.getElementById("payment-link").value.trim(),n={title:document.getElementById("title").value.trim(),description:e,syllabus:i,price:parseInt(document.getElementById("price").value),oldPrice:document.getElementById("old-price").value?parseInt(document.getElementById("old-price").value):void 0,duration:document.getElementById("duration").value.trim(),paymentLink:s,validityDays:document.getElementById("validity-days").value?parseInt(document.getElementById("validity-days").value):void 0,thumbCssClass:document.getElementById("thumb-css-class").value,thumbBadge:document.getElementById("thumb-badge").value.trim(),thumbBadgeStyle:document.getElementById("thumb-badge-style").value,thumbTopLabel:document.getElementById("thumb-top-label").value.trim(),thumbMainHeading:document.getElementById("thumb-main-heading").value.trim(),thumbSubHeading:document.getElementById("thumb-sub-heading").value.trim(),thumbPartTags:document.getElementById("thumb-part-tags").value.trim(),thumbBottomCaption:document.getElementById("thumb-bottom-caption").value.trim(),pdfIds:[],practiceTestIds:[]};if(!n.title){a("Please enter a course title","warning");return}this.submitBtn.disabled=!0;const o=this.submitBtn.textContent;this.submitBtn.textContent=this.editingCourseId?"Updating…":"Creating…";const d=this.editingCourseId?await p(this.editingCourseId,n):await g(n);d.success?(a(this.editingCourseId?"Course updated successfully!":"Course created successfully!","success"),this.form.reset(),this.cancelEdit(),await this.loadCourses()):a("Error: "+d.error,"error"),this.submitBtn.disabled=!1,this.submitBtn.textContent=o}async loadCourses(){this.coursesContainer.innerHTML=`
      <div class="skeleton-card" style="margin-bottom:var(--spacing-sm);flex-direction:row;align-items:center;justify-content:space-between;">
        <div style="flex:1;"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-text" style="width:50%;"></div></div>
        <div class="skeleton" style="width:80px;height:32px;border-radius:var(--radius-sm);"></div>
      </div>
      <div class="skeleton-card" style="margin-bottom:var(--spacing-sm);flex-direction:row;align-items:center;justify-content:space-between;">
        <div style="flex:1;"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-text" style="width:50%;"></div></div>
        <div class="skeleton" style="width:80px;height:32px;border-radius:var(--radius-sm);"></div>
      </div>
    `;const t=await y();t.success&&t.courses?(this.coursesList=t.courses,this.coursesContainer.innerHTML=t.courses.length>0?t.courses.map((e,i)=>this.renderCourseItem(e,i)).join(""):'<p style="text-align:center;color:#64748B;padding:2rem;">No courses yet. Create one using the form.</p>',this.attachEventListeners()):(this.coursesContainer.innerHTML='<p style="text-align:center;color:#DC2626;padding:2rem;">Failed to load courses.</p>',a("Failed to load courses: "+(t.error??"Unknown error"),"error"))}renderCourseItem(t,e){const i=e+1,s=e>0,n=e<this.coursesList.length-1;return`
      <div class="course-card" data-id="${t.id}">
        <div class="course-info">
          <h3>${t.title}</h3>
          <div class="course-meta">
            <div class="meta-item"><i data-lucide="indian-rupee" width="13" height="13"></i> ${t.oldPrice?`<del style="color:#DC2626; margin-right:4px;">${t.oldPrice}</del>`:""}₹${t.price}</div>
            <div class="meta-item"><i data-lucide="clock" width="13" height="13"></i> ${t.duration}</div>
            ${t.paymentLink?'<div class="meta-item" style="color:#16A34A;"><i data-lucide="link" width="13" height="13"></i> Payment Link ✓</div>':""}
            <div class="meta-item"><i data-lucide="hash" width="13" height="13"></i> Rank #${i}</div>
          </div>
        </div>
        <div class="btn-icon-group">
          <div style="display:flex;flex-direction:column;gap:3px;margin-right:6px;">
            <button class="btn-icon move-up-btn" data-id="${t.id}" data-index="${e}" ${s?"":"disabled"} title="Move up">
              <i data-lucide="chevron-up" width="15" height="15"></i>
            </button>
            <button class="btn-icon move-down-btn" data-id="${t.id}" data-index="${e}" ${n?"":"disabled"} title="Move down">
              <i data-lucide="chevron-down" width="15" height="15"></i>
            </button>
          </div>
          <button class="btn-icon edit-btn" data-id="${t.id}" title="Edit">
            <i data-lucide="edit-3" width="17" height="17"></i>
          </button>
          <button class="btn-icon delete delete-btn" data-id="${t.id}" title="Delete">
            <i data-lucide="trash-2" width="17" height="17"></i>
          </button>
        </div>
      </div>`}attachEventListeners(){window.lucide?.createIcons(),this.coursesContainer.querySelectorAll(".edit-btn").forEach(t=>{t.addEventListener("click",()=>{const e=t.getAttribute("data-id");e&&this.editCourse(e)})}),this.coursesContainer.querySelectorAll(".delete-btn").forEach(t=>{t.addEventListener("click",()=>{const e=t.getAttribute("data-id");e&&this.handleDelete(e,t)})}),this.coursesContainer.querySelectorAll(".move-up-btn:not([disabled])").forEach(t=>{t.addEventListener("click",()=>{const e=parseInt(t.getAttribute("data-index")??"0");this.moveCourse(e,-1)})}),this.coursesContainer.querySelectorAll(".move-down-btn:not([disabled])").forEach(t=>{t.addEventListener("click",()=>{const e=parseInt(t.getAttribute("data-index")??"0");this.moveCourse(e,1)})})}async handleDelete(t,e){const i=this.coursesList.find(d=>d.id===t);if(!await v("Delete Course?",`This will permanently delete "${i?.title??"this course"}". This cannot be undone.`,"Delete Course"))return;e.disabled=!0;const n=e.closest(".course-card");n&&(n.style.opacity="0.5");const o=await b(t);o.success?(a("Course deleted successfully!","success"),await this.loadCourses()):(a("Delete failed: "+o.error,"error"),e.disabled=!1,n&&(n.style.opacity="1"))}async moveCourse(t,e){const i=t+e;if(i<0||i>=this.coursesList.length)return;const s=this.coursesList[t],n=this.coursesList[i];if(!s?.id||!n?.id)return;const o=1e3,d=typeof s.rank=="number"?s.rank:o+t,u=typeof n.rank=="number"?n.rank:o+i,[r,l]=await Promise.all([c(s.id,u),c(n.id,d)]);r.success&&l.success?(a("Course order updated!","info"),await this.loadCourses()):a("Error updating order: "+(r.error??l.error),"error")}async editCourse(t){const e=this.coursesList.find(i=>i.id===t);e&&(this.editingCourseId=t,document.getElementById("title").value=e.title,document.getElementById("price").value=e.price.toString(),document.getElementById("old-price").value=e.oldPrice?e.oldPrice.toString():"",document.getElementById("duration").value=e.duration,document.getElementById("payment-link").value=e.paymentLink??"",document.getElementById("validity-days").value=e.validityDays?e.validityDays.toString():"",document.getElementById("syllabus").value=e.syllabus??"",document.getElementById("thumb-css-class").value=e.thumbCssClass??"thumb-fullcourse",document.getElementById("thumb-badge").value=e.thumbBadge??"",document.getElementById("thumb-badge-style").value=e.thumbBadgeStyle??"badge-pop",document.getElementById("thumb-top-label").value=e.thumbTopLabel??"",document.getElementById("thumb-main-heading").value=e.thumbMainHeading??"",document.getElementById("thumb-sub-heading").value=e.thumbSubHeading??"",document.getElementById("thumb-part-tags").value=e.thumbPartTags??"",document.getElementById("thumb-bottom-caption").value=e.thumbBottomCaption??"",this.parseDescriptionToForm(e.description),document.getElementById("form-title").textContent="Edit Course",this.submitBtn.textContent="Update Course",this.cancelBtn.style.display="block",this.form.scrollIntoView({behavior:"smooth"}),a(`Editing "${e.title}"`,"info",2e3))}cancelEdit(){this.editingCourseId=null,this.form.reset(),document.getElementById("thumb-css-class").value="thumb-fullcourse",document.getElementById("thumb-badge-style").value="badge-pop",document.getElementById("description-heading").value="",this.descriptionPointsContainer.innerHTML="",this.ensureDescriptionPoints(),document.getElementById("form-title").textContent="Create New Course",this.submitBtn.textContent="Create Course",this.cancelBtn.style.display="none"}}new f;
