import"./firebase-config-D0UifA0H.js";import{o as f,b as p,e as w,d as y,f as h,r as I,h as E,j as v}from"./auth-service-By807CDz.js";let u=!1;function c(e,n="info"){const t=document.getElementById("toast-container"),s=document.createElement("div");s.className=`toast ${n}`,s.textContent=e,t.appendChild(s),setTimeout(()=>{s.style.animation="fadeOut 0.3s ease forwards",setTimeout(()=>s.remove(),300)},4e3)}function B(e){document.getElementById("panel-signin").classList.toggle("active",e==="signin"),document.getElementById("panel-signup").classList.toggle("active",e==="signup"),document.getElementById("tab-signin").classList.toggle("active",e==="signin"),document.getElementById("tab-signup").classList.toggle("active",e==="signup"),document.getElementById("auth-tabs").style.display="flex",document.getElementById("forgot-section").classList.remove("active"),l()}function S(){document.getElementById("panel-signin").classList.remove("active"),document.getElementById("auth-tabs").style.display="none",document.getElementById("forgot-section").classList.add("active"),document.getElementById("fp-email").focus()}function m(){document.getElementById("forgot-section").classList.remove("active"),document.getElementById("auth-tabs").style.display="flex",document.getElementById("panel-signin").classList.add("active");const e=document.getElementById("fp-signup-cta");e&&(e.style.display="none"),l()}function l(){document.querySelectorAll(".field-error").forEach(e=>{e.textContent="",e.classList.remove("show")})}function a(e,n){const t=document.getElementById(e);t&&(t.textContent=n,t.classList.add("show"))}async function d(e,n){u=!0;try{await E(e,n?{name:n}:void 0),await v(e.uid)}catch(i){console.warn("[Auth] Post-login Firestore save failed:",i)}try{sessionStorage.setItem("app_toast_msg","Welcome back! You are successfully signed in ðŸ‘‹"),sessionStorage.setItem("app_toast_type","success")}catch{}const s=new URLSearchParams(window.location.search).get("redirect"),o=s||"./index.html";window.location.href=o}async function b(){l();const e=document.getElementById("si-email").value.trim(),n=document.getElementById("si-password").value;if(!e)return a("si-email-error","Please enter your email");if(!n)return a("si-pass-error","Please enter your password");const t=document.getElementById("si-btn");t.disabled=!0,t.textContent="Signing in...";const s=await p(e,n);if(!s.success||!s.user){t.disabled=!1,t.textContent="Sign In";const o=s.error?.includes("invalid-credential")||s.error?.includes("wrong-password")?"Incorrect email or password.":s.error?.includes("user-not-found")?"No account found with this email.":s.error||"Sign in failed.";return a("si-pass-error",o)}t.textContent="Redirecting...",await d(s.user)}async function C(){l();const e=document.getElementById("su-name").value.trim(),n=document.getElementById("su-email").value.trim(),t=document.getElementById("su-password").value,s=document.getElementById("su-confirm").value;let o=!0;if(e||(a("su-name-error","Please enter your full name"),o=!1),n||(a("su-email-error","Please enter your email"),o=!1),t?t.length<6&&(a("su-pass-error","Password must be at least 6 characters"),o=!1):(a("su-pass-error","Please enter a password"),o=!1),t!==s&&(a("su-confirm-error","Passwords do not match"),o=!1),!o)return;const i=document.getElementById("su-btn");i.disabled=!0,i.textContent="Creating account...";const r=await w(n,t);if(!r.success||!r.user){i.disabled=!1,i.textContent="Create Account";const g=r.error?.includes("email-already-in-use")?"An account with this email already exists.":r.error||"Sign up failed.";return a("su-email-error",g)}i.textContent="Setting up...",await d(r.user,e)}async function P(){const e=document.getElementById("si-google-btn"),n=document.getElementById("su-google-btn");[e,n].forEach(s=>{s&&(s.disabled=!0)});const t=await y();if(!t.success||!t.user){[e,n].forEach(o=>{o&&(o.disabled=!1)});const s=t.error?.includes("popup-closed-by-user")?"Sign-in cancelled.":t.error||"Google sign-in failed.";return c(s,"error")}c("Signed in! Setting up...","info"),await d(t.user)}async function x(){l();const e=document.getElementById("fp-email").value.trim();if(!e)return a("fp-error","Please enter your email address");const n=document.getElementById("fp-btn");if(n.disabled=!0,n.textContent="Checking...",!await h(e)){n.disabled=!1,n.textContent="Send Reset Link",a("fp-error","No account found with this email. Please sign up first.");const o=document.getElementById("fp-signup-cta");o&&(o.style.display="block");return}n.textContent="Sending...";const s=await I(e);n.disabled=!1,n.textContent="Send Reset Link",s.success?(c("Reset link sent! Check your inbox.","success"),setTimeout(()=>m(),1600)):a("fp-error",s.error||"Failed to send reset link.")}window.switchTab=B;window.showForgot=S;window.hideForgot=m;window.handleSignIn=b;window.handleSignUp=C;window.handleGoogle=P;window.handleForgotPassword=x;f(e=>{if(e&&!u){const t=new URLSearchParams(window.location.search).get("redirect"),s=t||"./index.html";window.location.href=s}});document.addEventListener("DOMContentLoaded",()=>{new URLSearchParams(window.location.search).get("error")==="session_conflict"&&(c("You have been logged in on another device. Please login again.","error"),window.history.replaceState({},document.title,window.location.pathname));const n=sessionStorage.getItem("app_toast_msg"),t=sessionStorage.getItem("app_toast_type")||"success";n&&(setTimeout(()=>c(n,t),500),sessionStorage.removeItem("app_toast_msg"),sessionStorage.removeItem("app_toast_type"))});
