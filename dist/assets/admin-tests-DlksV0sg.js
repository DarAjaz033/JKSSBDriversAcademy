import"./firebase-config-CsUtaHqz.js";/* empty css               */import{o as d}from"./auth-service-BYs2Equ7.js";import{i as u,p as h,a as m,u as p,f,o as g,g as v}from"./admin-service-WdanE3z8.js";import{d as E,p as w}from"./excel-parser-DjJFnkkE.js";import{s as i,a as T}from"./admin-toast-8NJD7knF.js";class y{constructor(){this.questions=[],this.form=document.getElementById("test-form"),this.uploadArea=document.getElementById("upload-area"),this.excelInput=document.getElementById("excel-input"),this.fileNameEl=document.getElementById("file-name"),this.testsContainer=document.getElementById("tests-container"),this.courseSelect=document.getElementById("course-select"),this.submitBtn=document.getElementById("submit-btn"),this.downloadTemplateBtn=document.getElementById("download-template-btn"),this.init()}async init(){d(async e=>{if(!e){window.location.href="./admin-login.html";return}if(!await u(e)){window.location.href="./admin-login.html";return}this.setupUploadArea(),this.form.addEventListener("submit",s=>this.handleSubmit(s)),this.downloadTemplateBtn.addEventListener("click",()=>E()),await this.loadTests(),await this.loadCourses()},!0)}setupUploadArea(){this.uploadArea.addEventListener("click",()=>this.excelInput.click()),this.excelInput.addEventListener("change",()=>this.handleFileSelect()),this.uploadArea.addEventListener("dragover",e=>{e.preventDefault(),this.uploadArea.classList.add("dragover")}),this.uploadArea.addEventListener("dragleave",()=>{this.uploadArea.classList.remove("dragover")}),this.uploadArea.addEventListener("drop",e=>{var s;e.preventDefault(),this.uploadArea.classList.remove("dragover");const t=(s=e.dataTransfer)==null?void 0:s.files;t&&t.length>0&&(this.excelInput.files=t,this.handleFileSelect())})}async handleFileSelect(){var s;const e=(s=this.excelInput.files)==null?void 0:s[0];if(!e)return;if(!["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel"].includes(e.type)&&!e.name.endsWith(".xlsx")&&!e.name.endsWith(".xls")){i("Please select an Excel (.xlsx) file","warning");return}try{this.fileNameEl.textContent="Parsing Excel file...",this.questions=await w(e),this.fileNameEl.textContent=`âœ“ Loaded ${this.questions.length} questions from ${e.name}`,this.fileNameEl.style.color="#16A34A",i(`Loaded ${this.questions.length} questions`,"success",2500)}catch{i("Error parsing Excel file. Check the format and try again.","error"),this.fileNameEl.textContent="",this.questions=[]}}async handleSubmit(e){if(e.preventDefault(),this.questions.length===0){i("Please upload an Excel file with questions","warning");return}const t=document.getElementById("title").value,s=document.getElementById("description").value,l=parseInt(document.getElementById("duration").value),n=this.courseSelect.value;this.submitBtn.disabled=!0,this.submitBtn.textContent="Creating...";const c={title:t,description:s,questions:this.questions,duration:l};n&&(c.courseId=n);const a=await h(c);if(a.success&&a.id){if(n){const o=await m(n);if(o.success&&o.course){const r=o.course;r.practiceTestIds.includes(a.id)||(r.practiceTestIds.push(a.id),await p(n,{practiceTestIds:r.practiceTestIds}))}}i("Practice test created successfully!","success"),this.form.reset(),this.fileNameEl.textContent="",this.questions=[],await this.loadTests()}else i("Error: "+a.error,"error");this.submitBtn.disabled=!1,this.submitBtn.textContent="Create Practice Test"}async loadTests(){const e=await f();e.success&&e.tests?(this.testsContainer.innerHTML=e.tests.map(t=>this.renderTestItem(t)).join(""),this.attachEventListeners()):this.testsContainer.innerHTML='<p style="text-align: center; color: #64748B; padding: 2rem;">No practice tests found.</p>'}renderTestItem(e){return`
      <div class="test-card">
        <div class="test-info">
          <h3>${e.title}</h3>
          <p style="font-size: 0.875rem; color: #64748B; margin-bottom: 0.75rem;">${e.description}</p>
          <div class="test-meta">
            <div class="meta-item">
              <i data-lucide="help-circle" width="14" height="14"></i>
              ${e.questions.length} questions
            </div>
            <div class="meta-item">
              <i data-lucide="clock" width="14" height="14"></i>
              ${e.duration} minutes
            </div>
          </div>
        </div>
        <button class="btn-icon delete delete-btn" data-id="${e.id}" title="Delete Test">
          <i data-lucide="trash-2" width="18" height="18"></i>
        </button>
      </div>
    `}attachEventListeners(){window.lucide.createIcons(),document.querySelectorAll(".delete-btn").forEach(e=>{e.addEventListener("click",t=>{const s=t.currentTarget.getAttribute("data-id");s&&this.deleteTest(s)})})}async deleteTest(e){if(!await T("Delete Practice Test?","This will permanently delete the test and all its questions.","Delete Test"))return;const s=await g(e);s.success?(i("Practice test deleted.","success"),await this.loadTests()):i("Error: "+s.error,"error")}async loadCourses(){const e=await v();e.success&&e.courses&&(this.courseSelect.innerHTML='<option value="">None / General</option>'+e.courses.map(t=>`<option value="${t.id}">${t.title}</option>`).join(""))}}new y;
