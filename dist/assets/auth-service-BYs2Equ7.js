import{p as v,t as n,v as d,d as u,a as m,x as w,y as S,G as I,z as k,A as T,B as U,C as A,g as p,s as h}from"./firebase-config-CsUtaHqz.js";const C=async(e,s)=>{try{return{success:!0,user:(await U(n,e,s)).user}}catch(r){return{success:!1,error:r.message}}},_=async(e,s)=>{try{const r=await S(n,e,s);return await g(r.user.uid),{success:!0,user:r.user}}catch(r){return{success:!1,error:r.message}}},P=async()=>{try{const e=new I,s=await k(n,e);return await g(s.user.uid),{success:!0,user:s.user}}catch(e){return{success:!1,error:e.message}}},R=async e=>{try{return await T(n,e),{success:!0}}catch(s){return{success:!1,error:s.message}}},W=async()=>{try{return await w(n),{success:!0}}catch(e){return{success:!1,error:e.message}}};let f=null,y=!1;const N=(e,s=!1)=>(!s&&y&&e(f),v(n,r=>{f=r,y=!0,e(r)})),b=()=>n.currentUser,L=async(e,s)=>{var r;try{const t=u(m,"users",e.uid),c=await p(t),i=((r=e.providerData[0])==null?void 0:r.providerId)||"email",a={email:e.email,photoURL:e.photoURL||null,provider:i,lastLogin:h()};return c.exists()?s!=null&&s.name?a.name=s.name:e.displayName&&(a.name=e.displayName):(a.name=(s==null?void 0:s.name)||e.displayName||"",a.createdAt=h()),await d(t,a,{merge:!0}),{success:!0}}catch(t){return{success:!1,error:t.message}}},l="jkssb_session_token",g=async e=>{try{const s=crypto.randomUUID?crypto.randomUUID():Date.now().toString()+Math.random().toString(36).slice(2);localStorage.setItem(l,s);const r=u(m,"users",e);return await d(r,{sessionToken:s},{merge:!0}),localStorage.setItem("jkssb_login_time",Date.now().toString()),s}catch(s){return console.error("Failed to setup session token:",s),null}};let o=null;const O=e=>{o&&clearInterval(o),o=setInterval(async()=>{var r;try{const t=localStorage.getItem(l);if(!t)return;const c=await p(u(m,"users",e));if(!c.exists())return;const i=(r=c.data())==null?void 0:r.sessionToken;i&&i!==t&&(console.warn("Session mismatch detected! Another device logged in."),clearInterval(o),localStorage.removeItem(l),await w(n),window.location.href="./login.html?error=session_conflict")}catch(t){console.warn("Session verifier check failed (network issue?):",t)}},15*1e3)},j=()=>{o&&(clearInterval(o),o=null)},F=async e=>{try{localStorage.removeItem(l),await d(u(m,"users",e),{sessionToken:null},{merge:!0})}catch{}},G=async e=>{try{return(await A(n,e)).length>0}catch{return!1}},K=g;export{j as a,_ as b,F as c,P as d,C as e,G as f,b as g,L as h,O as i,K as j,N as o,R as r,W as s};
