import"./firebase-config-CsUtaHqz.js";/* empty css               */import{o as m}from"./auth-service-BYs2Equ7.js";import{i as h,u as p,k as g,g as v,l as y,m as u}from"./admin-service-WdanE3z8.js";import{s as d,a as f}from"./admin-toast-8NJD7knF.js";class C{constructor(){this.editingCourseId=null,this.coursesList=[],this.form=document.getElementById("course-form"),this.submitBtn=document.getElementById("submit-btn"),this.cancelBtn=document.getElementById("cancel-btn"),this.coursesContainer=document.getElementById("courses-container"),this.descriptionPointsContainer=document.getElementById("description-points-container"),this.addPointBtn=document.getElementById("add-point-btn"),this.init()}async init(){m(async e=>{if(!e){window.location.href="./admin-login.html";return}if(!await h(e)){window.location.href="./admin-login.html";return}this.form.addEventListener("submit",i=>this.handleSubmit(i)),this.cancelBtn.addEventListener("click",()=>this.cancelEdit()),this.addPointBtn.addEventListener("click",()=>this.addDescriptionPoint()),this.ensureDescriptionPoints(),await this.loadCourses()},!0)}buildDescriptionFromForm(){const e=document.getElementById("description-heading").value.trim(),t=this.descriptionPointsContainer.querySelectorAll(".description-point-input"),i=Array.from(t).map(s=>s.value.trim()).filter(Boolean);if(i.length===0&&!e)return"";const n=i.map((s,o)=>`${o+1}. ${s}`);return e?[e,...n].join(" "):n.join(" ")}ensureDescriptionPoints(){this.descriptionPointsContainer.children.length===0&&this.addDescriptionPoint("",!1)}addDescriptionPoint(e="",t=!0){var a;const i=this.descriptionPointsContainer.children.length+1,n=document.createElement("div");n.className="description-point-row";const s=document.createElement("span");s.className="point-number",s.textContent=`${i}.`;const o=document.createElement("input");o.type="text",o.className="form-input description-point-input",o.placeholder="e.g., Identification of major assemblies",o.value=e;const r=document.createElement("button");r.type="button",r.className="btn-icon delete",r.title="Remove point",r.style.flexShrink="0",r.innerHTML='<i data-lucide="trash-2" width="16" height="16"></i>',r.addEventListener("click",()=>{n.remove(),this.updatePointNumbers()}),n.append(s,o,r),this.descriptionPointsContainer.appendChild(n),(a=window.lucide)==null||a.createIcons(),t&&o.focus()}updatePointNumbers(){this.descriptionPointsContainer.querySelectorAll(".description-point-row").forEach((e,t)=>{const i=e.querySelector(".point-number");i&&(i.textContent=`${t+1}.`)})}parseDescriptionToForm(e){const t=e.trim(),i=t.split(/\s*\d+\.\s+/).map(n=>n.trim()).filter(Boolean);document.getElementById("description-heading").value="",this.descriptionPointsContainer.innerHTML="",i.length>1?(document.getElementById("description-heading").value=i[0],i.slice(1).forEach(n=>this.addDescriptionPoint(n,!1))):t?this.addDescriptionPoint(t,!1):this.ensureDescriptionPoints()}async handleSubmit(e){e.preventDefault();const t=this.buildDescriptionFromForm(),i=document.getElementById("syllabus").value.trim(),n=document.getElementById("payment-link").value.trim(),s={title:document.getElementById("title").value.trim(),description:t,syllabus:i,price:parseInt(document.getElementById("price").value),duration:document.getElementById("duration").value.trim(),paymentLink:n,pdfIds:[],practiceTestIds:[]};if(!s.title){d("Please enter a course title","warning");return}this.submitBtn.disabled=!0;const o=this.submitBtn.textContent;this.submitBtn.textContent=this.editingCourseId?"Updating…":"Creating…";const r=this.editingCourseId?await p(this.editingCourseId,s):await g(s);r.success?(d(this.editingCourseId?"Course updated successfully!":"Course created successfully!","success"),this.form.reset(),this.cancelEdit(),await this.loadCourses()):d("Error: "+r.error,"error"),this.submitBtn.disabled=!1,this.submitBtn.textContent=o}async loadCourses(){this.coursesContainer.innerHTML=`
      <div class="skeleton-card" style="margin-bottom:var(--spacing-sm);flex-direction:row;align-items:center;justify-content:space-between;">
        <div style="flex:1;"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-text" style="width:50%;"></div></div>
        <div class="skeleton" style="width:80px;height:32px;border-radius:var(--radius-sm);"></div>
      </div>
      <div class="skeleton-card" style="margin-bottom:var(--spacing-sm);flex-direction:row;align-items:center;justify-content:space-between;">
        <div style="flex:1;"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-text" style="width:50%;"></div></div>
        <div class="skeleton" style="width:80px;height:32px;border-radius:var(--radius-sm);"></div>
      </div>
    `;const e=await v();e.success&&e.courses?(this.coursesList=e.courses,this.coursesContainer.innerHTML=e.courses.length>0?e.courses.map((t,i)=>this.renderCourseItem(t,i)).join(""):'<p style="text-align:center;color:#64748B;padding:2rem;">No courses yet. Create one using the form.</p>',this.attachEventListeners()):(this.coursesContainer.innerHTML='<p style="text-align:center;color:#DC2626;padding:2rem;">Failed to load courses.</p>',d("Failed to load courses: "+(e.error??"Unknown error"),"error"))}renderCourseItem(e,t){const i=t+1,n=t>0,s=t<this.coursesList.length-1;return`
      <div class="course-card" data-id="${e.id}">
        <div class="course-info">
          <h3>${e.title}</h3>
          <div class="course-meta">
            <div class="meta-item"><i data-lucide="indian-rupee" width="13" height="13"></i> ₹${e.price}</div>
            <div class="meta-item"><i data-lucide="clock" width="13" height="13"></i> ${e.duration}</div>
            ${e.paymentLink?'<div class="meta-item" style="color:#16A34A;"><i data-lucide="link" width="13" height="13"></i> Payment Link ✓</div>':""}
            <div class="meta-item"><i data-lucide="hash" width="13" height="13"></i> Rank #${i}</div>
          </div>
        </div>
        <div class="btn-icon-group">
          <div style="display:flex;flex-direction:column;gap:3px;margin-right:6px;">
            <button class="btn-icon move-up-btn" data-id="${e.id}" data-index="${t}" ${n?"":"disabled"} title="Move up">
              <i data-lucide="chevron-up" width="15" height="15"></i>
            </button>
            <button class="btn-icon move-down-btn" data-id="${e.id}" data-index="${t}" ${s?"":"disabled"} title="Move down">
              <i data-lucide="chevron-down" width="15" height="15"></i>
            </button>
          </div>
          <button class="btn-icon edit-btn" data-id="${e.id}" title="Edit">
            <i data-lucide="edit-3" width="17" height="17"></i>
          </button>
          <button class="btn-icon delete delete-btn" data-id="${e.id}" title="Delete">
            <i data-lucide="trash-2" width="17" height="17"></i>
          </button>
        </div>
      </div>`}attachEventListeners(){var e;(e=window.lucide)==null||e.createIcons(),this.coursesContainer.querySelectorAll(".edit-btn").forEach(t=>{t.addEventListener("click",()=>{const i=t.getAttribute("data-id");i&&this.editCourse(i)})}),this.coursesContainer.querySelectorAll(".delete-btn").forEach(t=>{t.addEventListener("click",()=>{const i=t.getAttribute("data-id");i&&this.handleDelete(i,t)})}),this.coursesContainer.querySelectorAll(".move-up-btn:not([disabled])").forEach(t=>{t.addEventListener("click",()=>{const i=parseInt(t.getAttribute("data-index")??"0");this.moveCourse(i,-1)})}),this.coursesContainer.querySelectorAll(".move-down-btn:not([disabled])").forEach(t=>{t.addEventListener("click",()=>{const i=parseInt(t.getAttribute("data-index")??"0");this.moveCourse(i,1)})})}async handleDelete(e,t){const i=this.coursesList.find(r=>r.id===e);if(!await f("Delete Course?",`This will permanently delete "${(i==null?void 0:i.title)??"this course"}". This cannot be undone.`,"Delete Course"))return;t.disabled=!0;const s=t.closest(".course-card");s&&(s.style.opacity="0.5");const o=await y(e);o.success?(d("Course deleted successfully!","success"),await this.loadCourses()):(d("Delete failed: "+o.error,"error"),t.disabled=!1,s&&(s.style.opacity="1"))}async moveCourse(e,t){const i=e+t;if(i<0||i>=this.coursesList.length)return;const n=this.coursesList[e],s=this.coursesList[i];if(!(n!=null&&n.id)||!(s!=null&&s.id))return;const o=1e3,r=typeof n.rank=="number"?n.rank:o+e,a=typeof s.rank=="number"?s.rank:o+i,[c,l]=await Promise.all([u(n.id,a),u(s.id,r)]);c.success&&l.success?(d("Course order updated!","info"),await this.loadCourses()):d("Error updating order: "+(c.error??l.error),"error")}async editCourse(e){const t=this.coursesList.find(i=>i.id===e);t&&(this.editingCourseId=e,document.getElementById("title").value=t.title,document.getElementById("price").value=t.price.toString(),document.getElementById("duration").value=t.duration,document.getElementById("payment-link").value=t.paymentLink??"",document.getElementById("syllabus").value=t.syllabus??"",this.parseDescriptionToForm(t.description),document.getElementById("form-title").textContent="Edit Course",this.submitBtn.textContent="Update Course",this.cancelBtn.style.display="block",this.form.scrollIntoView({behavior:"smooth"}),d(`Editing "${t.title}"`,"info",2e3))}cancelEdit(){this.editingCourseId=null,this.form.reset(),document.getElementById("description-heading").value="",this.descriptionPointsContainer.innerHTML="",this.ensureDescriptionPoints(),document.getElementById("form-title").textContent="Create New Course",this.submitBtn.textContent="Create Course",this.cancelBtn.style.display="none"}}new C;
