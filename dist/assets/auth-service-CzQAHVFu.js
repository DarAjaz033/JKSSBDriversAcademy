import{l as y,m as t,n as f,d as i,a as u,p as m,t as g,v as w,G as S,x as p,y as v,z as k,A as I,g as E,s as d}from"./firebase-config-DyDltD9C.js";const A=async(s,e)=>{try{return{success:!0,user:(await k(t,s,e)).user}}catch(r){return{success:!1,error:r.message}}},U=async(s,e)=>{try{return{success:!0,user:(await w(t,s,e)).user}}catch(r){return{success:!1,error:r.message}}},W=async()=>{try{const s=new S;return{success:!0,user:(await p(t,s)).user}}catch(s){return{success:!1,error:s.message}}},C=async s=>{try{return await v(t,s),{success:!0}}catch(e){return{success:!1,error:e.message}}},b=async()=>{try{return await g(t),{success:!0}}catch(s){return{success:!1,error:s.message}}},P=s=>y(t,e=>{s(e)}),R=()=>t.currentUser,N=async(s,e)=>{var r;try{const n=i(u,"users",s.uid),o=await E(n),h=((r=s.providerData[0])==null?void 0:r.providerId)||"email",a={email:s.email,photoURL:s.photoURL||null,provider:h,lastLogin:d()};return o.exists()?e!=null&&e.name?a.name=e.name:s.displayName&&(a.name=s.displayName):(a.name=(e==null?void 0:e.name)||s.displayName||"",a.createdAt=d()),await m(n,a,{merge:!0}),{success:!0}}catch(n){return{success:!1,error:n.message}}},c="jkssb_session_token",_=async s=>{try{const e=Date.now().toString()+Math.random().toString(36).slice(2);localStorage.setItem(c,e);const r=i(u,"users",s);return await m(r,{sessionToken:e},{merge:!0}),{success:!0,token:e}}catch(e){return{success:!1,error:e.message}}},O=async s=>{try{localStorage.removeItem(c),await m(i(u,"users",s),{sessionToken:null},{merge:!0})}catch{}},G=async s=>{try{return(await I(t,s)).length>0}catch{return!1}};let l=null;const L=s=>{l&&l(),l=f(i(u,"users",s),e=>{var o;if(!e.exists())return;const r=(o=e.data())==null?void 0:o.sessionToken,n=localStorage.getItem(c);r&&n&&r!==n&&(console.warn("[SessionWatcher] Session invalidated by another device."),localStorage.removeItem(c),g(t).then(()=>{window.location.href="./login.html"}))},()=>{})};export{b as a,U as b,O as c,W as d,A as e,G as f,R as g,N as h,_ as i,P as o,C as r,L as s};
