import{p as w,t as n,v as d,d as u,a as m,x as f,y as p,G as v,z as S,A as I,B as k,C as T,g as y,s as h}from"./firebase-config-CsUtaHqz.js";const E=async(e,s)=>{try{return{success:!0,user:(await k(n,e,s)).user}}catch(r){return{success:!1,error:r.message}}},A=async(e,s)=>{try{const r=await p(n,e,s);return await g(r.user.uid),{success:!0,user:r.user}}catch(r){return{success:!1,error:r.message}}},C=async()=>{try{const e=new v,s=await S(n,e);return await g(s.user.uid),{success:!0,user:s.user}}catch(e){return{success:!1,error:e.message}}},_=async e=>{try{return await I(n,e),{success:!0}}catch(s){return{success:!1,error:s.message}}},P=async()=>{try{return await f(n),{success:!0}}catch(e){return{success:!1,error:e.message}}},R=e=>w(n,s=>{e(s)}),W=()=>n.currentUser,N=async(e,s)=>{var r;try{const t=u(m,"users",e.uid),c=await y(t),i=((r=e.providerData[0])==null?void 0:r.providerId)||"email",a={email:e.email,photoURL:e.photoURL||null,provider:i,lastLogin:h()};return c.exists()?s!=null&&s.name?a.name=s.name:e.displayName&&(a.name=e.displayName):(a.name=(s==null?void 0:s.name)||e.displayName||"",a.createdAt=h()),await d(t,a,{merge:!0}),{success:!0}}catch(t){return{success:!1,error:t.message}}},l="jkssb_session_token",g=async e=>{try{const s=crypto.randomUUID?crypto.randomUUID():Date.now().toString()+Math.random().toString(36).slice(2);localStorage.setItem(l,s);const r=u(m,"users",e);return await d(r,{sessionToken:s},{merge:!0}),localStorage.setItem("jkssb_login_time",Date.now().toString()),s}catch(s){return console.error("Failed to setup session token:",s),null}};let o=null;const b=e=>{o&&clearInterval(o),o=setInterval(async()=>{var r;try{const t=localStorage.getItem(l);if(!t)return;const c=await y(u(m,"users",e));if(!c.exists())return;const i=(r=c.data())==null?void 0:r.sessionToken;i&&i!==t&&(console.warn("Session mismatch detected! Another device logged in."),clearInterval(o),localStorage.removeItem(l),await f(n),window.location.href="./login.html?error=session_conflict")}catch(t){console.warn("Session verifier check failed (network issue?):",t)}},15*1e3)},L=()=>{o&&(clearInterval(o),o=null)},O=async e=>{try{localStorage.removeItem(l),await d(u(m,"users",e),{sessionToken:null},{merge:!0})}catch{}},j=async e=>{try{return(await T(n,e)).length>0}catch{return!1}},F=g;export{L as a,A as b,O as c,C as d,E as e,j as f,W as g,N as h,b as i,F as j,R as o,_ as r,P as s};
