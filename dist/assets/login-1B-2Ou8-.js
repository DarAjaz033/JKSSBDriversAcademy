import"./firebase-config-CsUtaHqz.js";import{o as p,b as y,e as w,d as h,f as I,r as E,h as v,j as B}from"./auth-service-BYs2Equ7.js";let m=!1;function l(e,n="info"){const t=document.getElementById("toast-container"),s=document.createElement("div");s.className=`toast ${n}`,s.textContent=e,t.appendChild(s),setTimeout(()=>{s.style.animation="fadeOut 0.3s ease forwards",setTimeout(()=>s.remove(),300)},4e3)}function b(e){document.getElementById("panel-signin").classList.toggle("active",e==="signin"),document.getElementById("panel-signup").classList.toggle("active",e==="signup"),document.getElementById("tab-signin").classList.toggle("active",e==="signin"),document.getElementById("tab-signup").classList.toggle("active",e==="signup"),document.getElementById("auth-tabs").style.display="flex",document.getElementById("forgot-section").classList.remove("active"),c()}function S(){document.getElementById("panel-signin").classList.remove("active"),document.getElementById("auth-tabs").style.display="none",document.getElementById("forgot-section").classList.add("active"),document.getElementById("fp-email").focus()}function g(){document.getElementById("forgot-section").classList.remove("active"),document.getElementById("auth-tabs").style.display="flex",document.getElementById("panel-signin").classList.add("active");const e=document.getElementById("fp-signup-cta");e&&(e.style.display="none"),c()}function c(){document.querySelectorAll(".field-error").forEach(e=>{e.textContent="",e.classList.remove("show")})}function i(e,n){const t=document.getElementById(e);t&&(t.textContent=n,t.classList.add("show"))}async function u(e,n){m=!0;try{await v(e,n?{name:n}:void 0),await B(e.uid)}catch(t){console.warn("[Auth] Post-login Firestore save failed:",t)}try{sessionStorage.setItem("app_toast_msg","Welcome back! You are successfully signed in ðŸ‘‹"),sessionStorage.setItem("app_toast_type","success")}catch{}window.location.href="./index.html"}async function C(){var o,a,r;c();const e=document.getElementById("si-email").value.trim(),n=document.getElementById("si-password").value;if(!e)return i("si-email-error","Please enter your email");if(!n)return i("si-pass-error","Please enter your password");const t=document.getElementById("si-btn");t.disabled=!0,t.textContent="Signing in...";const s=await y(e,n);if(!s.success||!s.user){t.disabled=!1,t.textContent="Sign In";const d=(o=s.error)!=null&&o.includes("invalid-credential")||(a=s.error)!=null&&a.includes("wrong-password")?"Incorrect email or password.":(r=s.error)!=null&&r.includes("user-not-found")?"No account found with this email.":s.error||"Sign in failed.";return i("si-pass-error",d)}t.textContent="Redirecting...",await u(s.user)}async function x(){var d;c();const e=document.getElementById("su-name").value.trim(),n=document.getElementById("su-email").value.trim(),t=document.getElementById("su-password").value,s=document.getElementById("su-confirm").value;let o=!0;if(e||(i("su-name-error","Please enter your full name"),o=!1),n||(i("su-email-error","Please enter your email"),o=!1),t?t.length<6&&(i("su-pass-error","Password must be at least 6 characters"),o=!1):(i("su-pass-error","Please enter a password"),o=!1),t!==s&&(i("su-confirm-error","Passwords do not match"),o=!1),!o)return;const a=document.getElementById("su-btn");a.disabled=!0,a.textContent="Creating account...";const r=await w(n,t);if(!r.success||!r.user){a.disabled=!1,a.textContent="Create Account";const f=(d=r.error)!=null&&d.includes("email-already-in-use")?"An account with this email already exists.":r.error||"Sign up failed.";return i("su-email-error",f)}a.textContent="Setting up...",await u(r.user,e)}async function L(){var s;const e=document.getElementById("si-google-btn"),n=document.getElementById("su-google-btn");[e,n].forEach(o=>{o&&(o.disabled=!0)});const t=await h();if(!t.success||!t.user){[e,n].forEach(a=>{a&&(a.disabled=!1)});const o=(s=t.error)!=null&&s.includes("popup-closed-by-user")?"Sign-in cancelled.":t.error||"Google sign-in failed.";return l(o,"error")}l("Signed in! Setting up...","info"),await u(t.user)}async function P(){c();const e=document.getElementById("fp-email").value.trim();if(!e)return i("fp-error","Please enter your email address");const n=document.getElementById("fp-btn");if(n.disabled=!0,n.textContent="Checking...",!await I(e)){n.disabled=!1,n.textContent="Send Reset Link",i("fp-error","No account found with this email. Please sign up first.");const o=document.getElementById("fp-signup-cta");o&&(o.style.display="block");return}n.textContent="Sending...";const s=await E(e);n.disabled=!1,n.textContent="Send Reset Link",s.success?(l("Reset link sent! Check your inbox.","success"),setTimeout(()=>g(),1600)):i("fp-error",s.error||"Failed to send reset link.")}window.switchTab=b;window.showForgot=S;window.hideForgot=g;window.handleSignIn=C;window.handleSignUp=x;window.handleGoogle=L;window.handleForgotPassword=P;p(e=>{e&&!m&&(window.location.href="./index.html")});document.addEventListener("DOMContentLoaded",()=>{new URLSearchParams(window.location.search).get("error")==="session_conflict"&&(l("You have been logged in on another device. Please login again.","error"),window.history.replaceState({},document.title,window.location.pathname));const n=sessionStorage.getItem("app_toast_msg"),t=sessionStorage.getItem("app_toast_type")||"success";n&&(setTimeout(()=>l(n,t),500),sessionStorage.removeItem("app_toast_msg"),sessionStorage.removeItem("app_toast_type"))});
