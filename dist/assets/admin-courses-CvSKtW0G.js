import"./firebase-config-BMA5n-tq.js";/* empty css               */import{o as h}from"./auth-service-BxFBpYMV.js";import{i as m,u as p,k as g,a as y,l as C,m as u}from"./admin-service-DzNgPl0W.js";import{s as a,a as f}from"./admin-toast-8NJD7knF.js";class w{constructor(){this.editingCourseId=null,this.coursesList=[],this.form=document.getElementById("course-form"),this.submitBtn=document.getElementById("submit-btn"),this.cancelBtn=document.getElementById("cancel-btn"),this.coursesContainer=document.getElementById("courses-container"),this.categorySelect=document.getElementById("category"),this.newCategoryInput=document.getElementById("new-category"),this.descriptionPointsContainer=document.getElementById("description-points-container"),this.addPointBtn=document.getElementById("add-point-btn"),this.init()}async init(){h(async t=>{if(!t){window.location.href="./admin-login.html";return}if(!await m(t)){window.location.href="./admin-login.html";return}this.form.addEventListener("submit",i=>this.handleSubmit(i)),this.cancelBtn.addEventListener("click",()=>this.cancelEdit()),this.categorySelect.addEventListener("change",()=>this.toggleNewCategoryInput()),this.addPointBtn.addEventListener("click",()=>this.addDescriptionPoint()),this.ensureDescriptionPoints(),await this.loadCourses()})}buildDescriptionFromForm(){const t=document.getElementById("description-heading").value.trim(),e=this.descriptionPointsContainer.querySelectorAll(".description-point-input"),i=Array.from(e).map(s=>s.value.trim()).filter(Boolean);if(i.length===0&&!t)throw new Error("Please add at least a description heading or one point");const n=i.map((s,o)=>`${o+1}. ${s}`);return t?[t,...n].join(" "):n.join(" ")}ensureDescriptionPoints(){this.descriptionPointsContainer.children.length===0&&this.addDescriptionPoint("",!1)}addDescriptionPoint(t="",e=!0){var c;const i=this.descriptionPointsContainer.children.length+1,n=document.createElement("div");n.className="description-point-row";const s=document.createElement("span");s.className="point-number",s.textContent=`${i}.`;const o=document.createElement("input");o.type="text",o.className="form-input description-point-input",o.placeholder="e.g., Identification of major assemblies",o.value=t;const r=document.createElement("button");r.type="button",r.className="btn-icon delete",r.title="Remove point",r.style.flexShrink="0",r.innerHTML='<i data-lucide="trash-2" width="16" height="16"></i>',r.addEventListener("click",()=>{n.remove(),this.updatePointNumbers()}),n.append(s,o,r),this.descriptionPointsContainer.appendChild(n),(c=window.lucide)==null||c.createIcons(),e&&o.focus()}updatePointNumbers(){this.descriptionPointsContainer.querySelectorAll(".description-point-row").forEach((t,e)=>{const i=t.querySelector(".point-number");i&&(i.textContent=`${e+1}.`)})}parseDescriptionToForm(t){const e=t.trim(),i=e.split(/\s*\d+\.\s+/).map(n=>n.trim()).filter(Boolean);document.getElementById("description-heading").value="",this.descriptionPointsContainer.innerHTML="",i.length>1?(document.getElementById("description-heading").value=i[0],i.slice(1).forEach(n=>this.addDescriptionPoint(n,!1))):e?this.addDescriptionPoint(e,!1):this.ensureDescriptionPoints()}getSelectedCategory(){const t=this.categorySelect.value;if(t==="__new__"){const e=this.newCategoryInput.value.trim();if(!e)throw this.newCategoryInput.focus(),new Error("Please enter the new category name");return e}if(!t)throw this.categorySelect.focus(),new Error("Please select or create a category");return t}toggleNewCategoryInput(){const t=this.categorySelect.value==="__new__";this.newCategoryInput.style.display=t?"block":"none",this.newCategoryInput.required=t,this.newCategoryInput.value="",t&&this.newCategoryInput.focus()}async handleSubmit(t){t.preventDefault();let e,i;try{e=this.getSelectedCategory(),i=this.buildDescriptionFromForm()}catch(r){a(r instanceof Error?r.message:"Please fill in all required fields","warning");return}const n={title:document.getElementById("title").value,description:i,price:parseInt(document.getElementById("price").value),duration:document.getElementById("duration").value,category:e,pdfIds:[],practiceTestIds:[]};this.submitBtn.disabled=!0;const s=this.submitBtn.textContent;this.submitBtn.textContent=this.editingCourseId?"Updating…":"Creating…";const o=this.editingCourseId?await p(this.editingCourseId,n):await g(n);o.success?(a(this.editingCourseId?"Course updated successfully!":"Course created successfully!","success"),this.form.reset(),this.cancelEdit(),await this.loadCourses()):a("Error: "+o.error,"error"),this.submitBtn.disabled=!1,this.submitBtn.textContent=s}async loadCourses(){this.coursesContainer.innerHTML="";const t=await y();t.success&&t.courses?(this.coursesList=t.courses,this.populateCategoryOptions(t.courses),this.coursesContainer.innerHTML=t.courses.length>0?t.courses.map((e,i)=>this.renderCourseItem(e,i)).join(""):'<p style="text-align:center;color:#64748B;padding:2rem;">No courses yet. Create one using the form.</p>',this.attachEventListeners()):(this.coursesContainer.innerHTML='<p style="text-align:center;color:#DC2626;padding:2rem;">Failed to load courses.</p>',a("Failed to load courses: "+(t.error??"Unknown error"),"error"))}populateCategoryOptions(t){const e=new Set(Array.from(this.categorySelect.options).map(i=>i.value));t.forEach(i=>{if(i.category&&i.category!=="__new__"&&!e.has(i.category)){e.add(i.category);const n=document.createElement("option");n.value=i.category,n.textContent=i.category,this.categorySelect.insertBefore(n,this.categorySelect.lastElementChild)}})}renderCourseItem(t,e){const i=e+1,n=e>0,s=e<this.coursesList.length-1;return`
      <div class="course-card" data-id="${t.id}">
        <div class="course-info">
          <div class="course-badge">${t.category}</div>
          <h3>${t.title}</h3>
          <div class="course-meta">
            <div class="meta-item"><i data-lucide="indian-rupee" width="13" height="13"></i> ${t.price}</div>
            <div class="meta-item"><i data-lucide="clock" width="13" height="13"></i> ${t.duration}</div>
            <div class="meta-item"><i data-lucide="hash" width="13" height="13"></i> Rank #${i}</div>
          </div>
        </div>
        <div class="btn-icon-group">
          <div style="display:flex;flex-direction:column;gap:3px;margin-right:6px;">
            <button class="btn-icon move-up-btn" data-id="${t.id}" data-index="${e}" ${n?"":"disabled"} title="Move up">
              <i data-lucide="chevron-up" width="15" height="15"></i>
            </button>
            <button class="btn-icon move-down-btn" data-id="${t.id}" data-index="${e}" ${s?"":"disabled"} title="Move down">
              <i data-lucide="chevron-down" width="15" height="15"></i>
            </button>
          </div>
          <button class="btn-icon edit-btn" data-id="${t.id}" title="Edit">
            <i data-lucide="edit-3" width="17" height="17"></i>
          </button>
          <button class="btn-icon delete delete-btn" data-id="${t.id}" title="Delete">
            <i data-lucide="trash-2" width="17" height="17"></i>
          </button>
        </div>
      </div>`}attachEventListeners(){var t;(t=window.lucide)==null||t.createIcons(),this.coursesContainer.querySelectorAll(".edit-btn").forEach(e=>{e.addEventListener("click",()=>{const i=e.getAttribute("data-id");i&&this.editCourse(i)})}),this.coursesContainer.querySelectorAll(".delete-btn").forEach(e=>{e.addEventListener("click",()=>{const i=e.getAttribute("data-id");i&&this.handleDelete(i,e)})}),this.coursesContainer.querySelectorAll(".move-up-btn:not([disabled])").forEach(e=>{e.addEventListener("click",()=>{const i=parseInt(e.getAttribute("data-index")??"0");this.moveCourse(i,-1)})}),this.coursesContainer.querySelectorAll(".move-down-btn:not([disabled])").forEach(e=>{e.addEventListener("click",()=>{const i=parseInt(e.getAttribute("data-index")??"0");this.moveCourse(i,1)})})}async handleDelete(t,e){const i=this.coursesList.find(r=>r.id===t);if(!await f("Delete Course?",`This will permanently delete "${(i==null?void 0:i.title)??"this course"}". This cannot be undone.`,"Delete Course"))return;e.disabled=!0;const s=e.closest(".course-card");s&&(s.style.opacity="0.5");const o=await C(t);o.success?(a("Course deleted successfully!","success"),await this.loadCourses()):(a("Delete failed: "+o.error,"error"),e.disabled=!1,s&&(s.style.opacity="1"))}async moveCourse(t,e){const i=t+e;if(i<0||i>=this.coursesList.length)return;const n=this.coursesList[t],s=this.coursesList[i];if(!(n!=null&&n.id)||!(s!=null&&s.id))return;const o=1e3,r=typeof n.rank=="number"?n.rank:o+t,c=typeof s.rank=="number"?s.rank:o+i,[d,l]=await Promise.all([u(n.id,c),u(s.id,r)]);d.success&&l.success?(a("Course order updated!","info"),await this.loadCourses()):a("Error updating order: "+(d.error??l.error),"error")}async editCourse(t){const e=this.coursesList.find(n=>n.id===t);if(!e)return;this.editingCourseId=t,document.getElementById("title").value=e.title,this.parseDescriptionToForm(e.description),document.getElementById("price").value=e.price.toString(),document.getElementById("duration").value=e.duration,Array.from(this.categorySelect.options).find(n=>n.value===e.category)?(this.categorySelect.value=e.category,this.newCategoryInput.style.display="none"):(this.categorySelect.value="__new__",this.newCategoryInput.style.display="block",this.newCategoryInput.value=e.category),document.getElementById("form-title").textContent="Edit Course",this.submitBtn.textContent="Update Course",this.cancelBtn.style.display="block",this.form.scrollIntoView({behavior:"smooth"}),a(`Editing "${e.title}"`,"info",2e3)}cancelEdit(){this.editingCourseId=null,this.form.reset(),document.getElementById("description-heading").value="",this.descriptionPointsContainer.innerHTML="",this.ensureDescriptionPoints(),this.newCategoryInput.style.display="none",this.newCategoryInput.value="",document.getElementById("form-title").textContent="Create New Course",this.submitBtn.textContent="Create Course",this.cancelBtn.style.display="none"}}new w;
