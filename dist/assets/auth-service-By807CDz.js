import{p,t,v as m,d as l,a as u,x as y,y as v,G as S,z as I,A as k,B as T,C as U,g as w,s as g}from"./firebase-config-D0UifA0H.js";const E=async(e,s)=>{try{return{success:!0,user:(await T(t,e,s)).user}}catch(r){return{success:!1,error:r.message}}},C=async(e,s)=>{try{const r=await v(t,e,s);return await d(r.user.uid),{success:!0,user:r.user}}catch(r){return{success:!1,error:r.message}}},_=async()=>{try{const e=new S,s=await I(t,e);return await d(s.user.uid),{success:!0,user:s.user}}catch(e){return{success:!1,error:e.message}}},D=async e=>{try{return await k(t,e),{success:!0}}catch(s){return{success:!1,error:s.message}}},P=async()=>{try{return await y(t),{success:!0}}catch(e){return{success:!1,error:e.message}}};let h=null,f=!1;const R=(e,s=!1)=>(!s&&f&&e(h),p(t,r=>{h=r,f=!0,e(r)})),W=()=>t.currentUser,N=async(e,s)=>{try{const r=l(u,"users",e.uid),o=await w(r),c=e.providerData[0]?.providerId||"email",n={email:e.email,photoURL:e.photoURL||null,provider:c,lastLogin:g()};return o.exists()?s?.name?n.name=s.name:e.displayName&&(n.name=e.displayName):(n.name=s?.name||e.displayName||"",n.createdAt=g()),await m(r,n,{merge:!0}),{success:!0}}catch(r){return{success:!1,error:r.message}}},i="jkssb_session_token",d=async e=>{try{const s=crypto.randomUUID?crypto.randomUUID():Date.now().toString()+Math.random().toString(36).slice(2);localStorage.setItem(i,s);const r=l(u,"users",e);return await m(r,{sessionToken:s},{merge:!0}),localStorage.setItem("jkssb_login_time",Date.now().toString()),s}catch(s){return console.error("Failed to setup session token:",s),null}};let a=null;const b=e=>{a&&clearInterval(a),a=setInterval(async()=>{try{const r=localStorage.getItem(i);if(!r)return;const o=await w(l(u,"users",e));if(!o.exists())return;const c=o.data()?.sessionToken;c&&c!==r&&(console.warn("Session mismatch detected! Another device logged in."),clearInterval(a),localStorage.removeItem(i),await y(t),window.location.href="./login.html?error=session_conflict")}catch(r){console.warn("Session verifier check failed (network issue?):",r)}},15*1e3)},L=()=>{a&&(clearInterval(a),a=null)},O=async e=>{try{localStorage.removeItem(i),await m(l(u,"users",e),{sessionToken:null},{merge:!0})}catch{}},j=async e=>{try{return(await U(t,e)).length>0}catch{return!1}},x=d;export{L as a,C as b,O as c,_ as d,E as e,j as f,W as g,N as h,b as i,x as j,R as o,D as r,P as s};
